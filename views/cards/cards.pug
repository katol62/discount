extends ../layout

block content

    div.container
        div.row
            div.col-lg-4.col-lg-offset-4.col-md-6.col-md-offset-3.col-sm-12
                h2 Cards
            if account.role == 'admin'
                div.col-lg-12.margin-top
                    a(href='/organizations/'+oid+'/tariffs/'+tariff.id+'/transhes/'+transh+'/cards/tocsv') Export to CSV
            if items
                div.col-lg-12.margin-top

                    div.table-responsive

                        table.table.table-bordered
                            thead
                                tr: th Id
                                    th QR Code
                                    th NFS Code
                                    th M Code
                                    th Card Number
                                    th Transh Number
                            tbody
                                each item, i in items
                                    tr
                                        td #{item.cid}
                                        td #{item.qr_code}
                                        td #{item.nfs_code}
                                        td #{item.m_code}
                                        td #{item.card_nb}
                                        td #{item.transh}


                script(type='text/javascript').

                    function toCsv(oid, tariff, transh) {
                        var xhr = new XMLHttpRequest();
                        var url = '/organizations/'+oid+'/tariffs/'+tariff+'/transhes/'+transh+'/cards/tocsv';
                        xhr.open('PUT', url, true);
                        xhr.setRequestHeader('X-HTTP-Method-Override', 'POST');
                        xhr.onreadystatechange = function () {
                            if (xhr.readyState == XMLHttpRequest.DONE) {
                                location.reload();
                            }
                        }
                        xhr.send();
                    }

            if message
                div.col-lg-4.col-lg-offset-4.col-md-6.col-md-offset-3.col-sm-12.margin-top
                    span.mess.success #{message}

            if error
                div.col-lg-4.col-lg-offset-4.col-md-6.col-md-offset-3.col-sm-12.margin-top
                    span.mess.error #{error}

            if errors
                div.col-lg-4.col-lg-offset-4.col-md-6.col-md-offset-3.col-sm-12.margin-top
                    ul.error
                        for error in errors
                            li.mess.error!= error.msg
